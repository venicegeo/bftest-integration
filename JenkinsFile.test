node {
  def root = pwd()
  def nodejs = tool 'NodeJS_6'

  stage('Clean') {
    deleteDir()
  }

  stage('Setup') {
    git([
      url: "https://github.com/venicegeo/bftest-integration",
      poll: true,
      branch: "master"
    ])
  }

/* still not sure about the key in here so need to ask Seth if I can use the same key for bf in gitlab or I need to create a new set of keys in jenkins credentials for the following stage */

  stage('Test') {
    withCredentials([file(credentialsId: "${POSTMAN_SECRET_FILE}", variable: 'POSTMAN_FILE')]) {
      withEnv(["PATH+=${root}/node_modules/newman/bin:${nodejs}/bin", "PCF_SPACE=test", "HOME=${root}"]) {
        sh "npm install newman@2"
        sh "ci/beachfront.sh"
      }
    }
  }

  stage ('Cleanup') {
    deleteDir()
  }
}
